<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>塔羅抽牌</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 使用者狀態列 -->
    <div class="user-bar" id="userBar">
        <div class="user-info" id="userInfo" style="display: none;">
            <span id="userName"></span>
            <button class="calendar-btn" onclick="showCalendar()">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                    <rect x="7" y="14" width="3" height="3" rx="0.5" fill="currentColor" stroke="none"></rect>
                </svg>
            </button>
            <button class="shop-btn" onclick="showShop()">
                <svg class="pentacle-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10"></circle>
                    <circle cx="12" cy="12" r="7" stroke-width="1"></circle>
                    <polygon points="12,5 13.5,9.5 18,10 14.5,13 15.5,17.5 12,15 8.5,17.5 9.5,13 6,10 10.5,9.5" fill="currentColor" stroke="none"></polygon>
                </svg>
                <span class="coin-balance" id="coinBalance">0</span>
            </button>
            <button class="logout-btn" onclick="logout()">登出</button>
        </div>
        <div class="login-prompt" id="loginPrompt">
            <button class="login-btn" onclick="showLoginModal()">🔐 登入以儲存抽牌紀錄</button>
        </div>
    </div>

    <div class="container">
        <h1>✨ 塔羅抽牌 ✨</h1>
        
        <!-- 抽牌範圍選擇 -->
        <div class="deck-mode-selector">
            <span class="mode-label">抽牌範圍：</span>
            <div class="deck-toggle">
                <button class="deck-btn active" data-deck="all" onclick="setDeckMode('all')">
                    🎴 全抽 (78)
                </button>
                <button class="deck-btn" data-deck="major" onclick="setDeckMode('major')">
                    ⭐ 大牌 (22)
                </button>
                <button class="deck-btn" data-deck="minor40" onclick="setDeckMode('minor40')">
                    🔢 小牌 (40)
                </button>
                <button class="deck-btn" data-deck="minor56" onclick="setDeckMode('minor56')">
                    🃏 小牌 (56)
                </button>
            </div>
        </div>
        
        <!-- 解牌模式切換 -->
        <div class="reading-mode-selector">
            <span class="mode-label">解牌模式：</span>
            <div class="mode-toggle">
                <button class="mode-btn active" data-mode="question" onclick="setReadingMode('question')">
                    ❓ 問問題
                </button>
                <button class="mode-btn" data-mode="advice" onclick="setReadingMode('advice')">
                    💡 尋求建議
                </button>
            </div>
        </div>
        
        <div class="card-count-selector" id="countSelector">
            <button class="count-btn active" data-count="1">1</button>
            <button class="count-btn" data-count="3">3</button>
            <button class="count-btn" data-count="4">4</button>
            <button class="count-btn" data-count="5">5</button>
        </div>
        
        <button class="draw-btn" id="drawBtn">抽 牌</button>
        
        <div class="cards-display" id="cardsDisplay"></div>
        
        <div class="hover-hint" id="hoverHint" style="display: none;">👆 將滑鼠移到牌卡上查看牌義</div>
        
        <!-- AI 解牌區 -->
        <div class="ai-section" id="aiSection" style="display: none;">
            <div class="ai-btn-wrapper">
                <button class="ai-btn" id="aiBtn" onclick="requestAIReading()">
                    🔮 AI 解牌
                </button>
                <span class="ai-usage-info" id="aiUsageInfo">
                    <span class="free-count" id="freeCount">免費 5 次</span>
                    <span class="coin-cost" id="coinCost" style="display: none;">30 ⭐/次</span>
                    <button class="pricing-info-btn" onclick="showPricingInfo()" title="收費說明">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <circle cx="12" cy="16" r="1" fill="currentColor"></circle>
                        </svg>
                    </button>
                </span>
            </div>
            <div class="ai-result" id="aiResult" style="display: none;">
                <div class="ai-result-header">
                    <span>✨ AI 解牌結果</span>
                    <button class="ai-close-btn" onclick="hideAIResult()">✕</button>
                </div>
                <div class="ai-result-content" id="aiResultContent"></div>
            </div>
        </div>
        
        <!-- 筆記區 -->
        <div class="note-section" id="noteSection" style="display: none;">
            <div class="note-container">
                <textarea id="noteInput" placeholder="寫下你的感想或問題..." maxlength="50"></textarea>
                <div class="note-footer">
                    <span class="note-count"><span id="noteCharCount">0</span>/50</span>
                    <button class="note-save-btn" id="noteSaveBtn" onclick="saveNote()">💾 儲存筆記</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 登入彈窗 -->
    <div class="modal" id="loginModal" style="display: none;">
        <div class="modal-content">
            <button class="modal-close" onclick="hideLoginModal()">✕</button>
            <h2>登入</h2>
            <div class="login-form">
                <input type="email" id="emailInput" placeholder="電子郵件" />
                <input type="password" id="passwordInput" placeholder="密碼" />
                <button class="submit-btn" onclick="login()">登入</button>
                <div class="divider">或</div>
                <button class="google-btn" onclick="loginWithGoogle()">
                    <img src="https://www.google.com/favicon.ico" alt="Google" width="20">
                    使用 Google 登入
                </button>
                <p class="switch-text">
                    還沒有帳號？<a href="#" onclick="showRegisterModal()">註冊</a>
                </p>
            </div>
        </div>
    </div>

    <!-- 註冊彈窗 -->
    <div class="modal" id="registerModal" style="display: none;">
        <div class="modal-content">
            <button class="modal-close" onclick="hideRegisterModal()">✕</button>
            <h2>註冊</h2>
            <div class="login-form">
                <input type="text" id="registerName" placeholder="暱稱" />
                <input type="email" id="registerEmail" placeholder="電子郵件" />
                <input type="password" id="registerPassword" placeholder="密碼（至少6位）" />
                <button class="submit-btn" onclick="register()">註冊</button>
                <p class="switch-text">
                    已有帳號？<a href="#" onclick="showLoginModal()">登入</a>
                </p>
            </div>
        </div>
    </div>

    <!-- 日曆彈窗 -->
    <div class="modal" id="calendarModal" style="display: none;">
        <div class="modal-content modal-calendar">
            <button class="modal-close" onclick="hideCalendar()">✕</button>
            <h2>📅 抽牌日曆</h2>
            
            <!-- 統計區 -->
            <div class="calendar-stats">
                <div class="stat-item">
                    <span class="stat-icon">🔮</span>
                    <span class="stat-value" id="statTotalReadings">0</span>
                    <span class="stat-label">總抽牌次數</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">📆</span>
                    <span class="stat-value" id="statTotalDays">0</span>
                    <span class="stat-label">抽牌天數</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">🔥</span>
                    <span class="stat-value" id="statStreak">0</span>
                    <span class="stat-label">連續天數</span>
                </div>
            </div>
            
            <!-- 月份導航 -->
            <div class="calendar-nav">
                <button class="nav-btn" onclick="prevMonth()">‹</button>
                <span class="calendar-month" id="calendarMonth"></span>
                <button class="nav-btn" onclick="nextMonth()">›</button>
            </div>
            
            <!-- 日曆 -->
            <div class="calendar-grid">
                <div class="calendar-header">
                    <span>日</span><span>一</span><span>二</span><span>三</span><span>四</span><span>五</span><span>六</span>
                </div>
                <div class="calendar-days" id="calendarDays"></div>
            </div>
            
            <!-- 當日紀錄 -->
            <div class="day-readings" id="dayReadings" style="display: none;">
                <h3 id="dayReadingsTitle"></h3>
                <div class="day-readings-list" id="dayReadingsList"></div>
            </div>
        </div>
    </div>

    <!-- 商店彈窗 -->
    <div class="modal" id="shopModal" style="display: none;">
        <div class="modal-content modal-shop">
            <button class="modal-close" onclick="hideShop()">✕</button>
            <h2>⭐ 五角金幣商店</h2>
            
            <!-- 金幣餘額 -->
            <div class="shop-balance">
                <div class="balance-icon">⭐</div>
                <div class="balance-info">
                    <span class="balance-label">目前餘額</span>
                    <span class="balance-value" id="shopCoinBalance">0</span>
                </div>
            </div>
            
            <!-- 新手禮包提示 -->
            <div class="welcome-bonus" id="welcomeBonus">
                <div class="bonus-badge">🎁 新手禮包</div>
                <div class="bonus-text">完成任務可獲得 <strong>100 金幣</strong></div>
                <div class="bonus-tasks">
                    <div class="task-item" id="taskRegister">
                        <span class="task-check">✓</span>
                        <span>完成註冊</span>
                        <span class="task-reward">+50 ⭐</span>
                    </div>
                    <div class="task-item" id="taskFirstDraw">
                        <span class="task-check">○</span>
                        <span>完成首次抽牌</span>
                        <span class="task-reward">+20 ⭐</span>
                    </div>
                    <div class="task-item" id="taskStreak">
                        <span class="task-check">○</span>
                        <span>連續 3 天登入</span>
                        <span class="task-reward">+30 ⭐</span>
                    </div>
                </div>
            </div>
            
            <!-- 首儲優惠提示 -->
            <div class="first-purchase-banner" id="firstPurchaseBanner">
                <span class="banner-icon">🔥</span>
                <span class="banner-text">首次購買額外加贈 <strong>30%</strong></span>
            </div>
            
            <!-- 金幣包列表 -->
            <div class="coin-packages">
                <h3>💰 金幣包</h3>
                <div class="package-list">
                    <div class="package-item" onclick="selectPackage('trial')">
                        <div class="package-name">體驗包</div>
                        <div class="package-coins">52 ⭐</div>
                        <div class="package-bonus">+4%</div>
                        <div class="package-price">NT$ 50</div>
                        <div class="package-first-bonus">首購得 68 ⭐</div>
                    </div>
                    <div class="package-item" onclick="selectPackage('starter')">
                        <div class="package-name">入門包</div>
                        <div class="package-coins">105 ⭐</div>
                        <div class="package-bonus">+5%</div>
                        <div class="package-price">NT$ 100</div>
                        <div class="package-first-bonus">首購得 137 ⭐</div>
                    </div>
                    <div class="package-item popular" onclick="selectPackage('value')">
                        <div class="package-tag">最多人選</div>
                        <div class="package-name">小資包</div>
                        <div class="package-coins">330 ⭐</div>
                        <div class="package-bonus">+10%</div>
                        <div class="package-price">NT$ 300</div>
                        <div class="package-first-bonus">首購得 429 ⭐</div>
                    </div>
                    <div class="package-item" onclick="selectPackage('super')">
                        <div class="package-name">超值包</div>
                        <div class="package-coins">575 ⭐</div>
                        <div class="package-bonus">+15%</div>
                        <div class="package-price">NT$ 500</div>
                        <div class="package-first-bonus">首購得 748 ⭐</div>
                    </div>
                    <div class="package-item" onclick="selectPackage('premium')">
                        <div class="package-name">豪華包</div>
                        <div class="package-coins">1,200 ⭐</div>
                        <div class="package-bonus">+20%</div>
                        <div class="package-price">NT$ 1,000</div>
                        <div class="package-first-bonus">首購得 1,560 ⭐</div>
                    </div>
                    <div class="package-item best-value" onclick="selectPackage('ultimate')">
                        <div class="package-tag">最划算</div>
                        <div class="package-name">尊爵包</div>
                        <div class="package-coins">3,900 ⭐</div>
                        <div class="package-bonus">+30%</div>
                        <div class="package-price">NT$ 3,000</div>
                        <div class="package-first-bonus">首購得 5,070 ⭐</div>
                    </div>
                </div>
            </div>
            
            <!-- 訂閱方案 -->
            <div class="subscription-section">
                <h3>👑 會員訂閱</h3>
                <div class="subscription-list">
                    <div class="subscription-item" onclick="selectSubscription('basic')">
                        <div class="sub-name">入門會員</div>
                        <div class="sub-price">NT$ 79<span>/月</span></div>
                        <div class="sub-benefits">
                            <div>✓ 無限基礎 AI 解牌</div>
                            <div>✓ 每月贈送 50 ⭐</div>
                            <div>✓ 紀錄永久保存</div>
                        </div>
                    </div>
                    <div class="subscription-item recommended" onclick="selectSubscription('standard')">
                        <div class="sub-tag">推薦</div>
                        <div class="sub-name">標準會員</div>
                        <div class="sub-price">NT$ 149<span>/月</span></div>
                        <div class="sub-benefits">
                            <div>✓ 全功能無限使用</div>
                            <div>✓ 每月贈送 100 ⭐</div>
                            <div>✓ 進階牌陣</div>
                            <div>✓ 無廣告</div>
                        </div>
                    </div>
                    <div class="subscription-item" onclick="selectSubscription('pro')">
                        <div class="sub-name">專業會員</div>
                        <div class="sub-price">NT$ 299<span>/月</span></div>
                        <div class="sub-benefits">
                            <div>✓ 完整體驗</div>
                            <div>✓ 每月贈送 200 ⭐</div>
                            <div>✓ 優先客服</div>
                            <div>✓ 搶先體驗新功能</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 使用說明 -->
            <div class="shop-info">
                <p>💡 1 金幣 = 1 新台幣 | 金幣永久有效不過期</p>
                <p>🔮 AI 解牌消耗：無牌陣 30 ⭐ / 有牌陣 50 ⭐</p>
            </div>
        </div>
    </div>

    <!-- 收費說明彈窗 -->
    <div class="modal" id="pricingModal" style="display: none;">
        <div class="modal-content modal-pricing">
            <button class="modal-close" onclick="hidePricingInfo()">✕</button>
            <h2>💡 收費說明</h2>
            
            <!-- 免費額度 -->
            <div class="pricing-section free-section">
                <h3>🎁 免費額度</h3>
                <div class="pricing-card">
                    <div class="pricing-item">
                        <span class="item-icon">🔮</span>
                        <span class="item-name">每日抽牌</span>
                        <span class="item-value free">永久免費</span>
                    </div>
                    <div class="pricing-item">
                        <span class="item-icon">✨</span>
                        <span class="item-name">AI 解牌（無牌陣）</span>
                        <span class="item-value free">每月 5 次免費</span>
                    </div>
                    <div class="pricing-item">
                        <span class="item-icon">📝</span>
                        <span class="item-name">筆記功能</span>
                        <span class="item-value free">永久免費</span>
                    </div>
                    <div class="pricing-item">
                        <span class="item-icon">📅</span>
                        <span class="item-name">日曆紀錄</span>
                        <span class="item-value free">保存 30 天</span>
                    </div>
                </div>
            </div>
            
            <!-- 新手禮包 -->
            <div class="pricing-section bonus-section">
                <h3>🎉 新手禮包</h3>
                <div class="pricing-card">
                    <p class="bonus-desc">首次註冊即可獲得 <strong>100 ⭐</strong> 五角金幣！</p>
                    <div class="bonus-breakdown">
                        <div class="bonus-item">✓ 完成註冊 +50 ⭐</div>
                        <div class="bonus-item">✓ 首次抽牌 +20 ⭐</div>
                        <div class="bonus-item">✓ 連續 3 天登入 +30 ⭐</div>
                    </div>
                </div>
            </div>
            
            <!-- AI 解牌收費 -->
            <div class="pricing-section ai-section">
                <h3>🔮 AI 解牌收費</h3>
                <div class="pricing-card">
                    <div class="pricing-item">
                        <span class="item-icon">📋</span>
                        <span class="item-name">無牌陣解牌</span>
                        <span class="item-value paid">30 ⭐/次</span>
                    </div>
                    <div class="pricing-item">
                        <span class="item-icon">🎴</span>
                        <span class="item-name">有牌陣解牌</span>
                        <span class="item-value paid">50 ⭐/次</span>
                    </div>
                    <div class="pricing-item">
                        <span class="item-icon">💬</span>
                        <span class="item-name">AI 深度對話</span>
                        <span class="item-value paid">20 ⭐/次</span>
                    </div>
                </div>
                <p class="pricing-note">💡 免費次數用完後，才會開始消耗金幣</p>
            </div>
            
            <!-- 金幣說明 -->
            <div class="pricing-section coin-section">
                <h3>⭐ 五角金幣</h3>
                <div class="pricing-card">
                    <div class="coin-info">
                        <p>1 金幣 = 1 新台幣</p>
                        <p>金幣<strong>永久有效</strong>，不會過期</p>
                        <p>儲值越多，增量越高（最高 +30%）</p>
                    </div>
                    <button class="go-shop-btn" onclick="hidePricingInfo(); showShop();">
                        前往商店 →
                    </button>
                </div>
            </div>
            
            <!-- 會員優惠 -->
            <div class="pricing-section member-section">
                <h3>👑 會員專屬</h3>
                <div class="pricing-card">
                    <div class="member-benefits">
                        <div class="benefit-item">
                            <span class="benefit-title">入門會員</span>
                            <span class="benefit-desc">$79/月 · 無限基礎 AI 解牌</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-title">標準會員</span>
                            <span class="benefit-desc">$149/月 · 全功能無限使用</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-title">專業會員</span>
                            <span class="benefit-desc">$299/月 · 完整體驗 + 優先服務</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/tarot-data.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
